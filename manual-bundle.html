<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>هناده دكسن - مجموعتك الخاصة</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- خط Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* التنسيقات الأساسية للجسم والخط والاتجاه */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5; /* لون خلفية فاتح */
            direction: rtl; /* اتجاه النص من اليمين لليسار */
            text-align: right; /* محاذاة النص لليمين */
            padding-top: 4rem; /* مسافة علوية لترك مكان لشريط التنقل الثابت */
        }
        /* تنسيق شريط التنقل الثابت */
        .navbar {
            position: fixed; /* يجعل الشريط ثابتاً عند التمرير */
            top: 0;
            right: 0; /* يبدأ من اليمين بسبب RTL */
            width: 100%;
            background-color: #1a202c; /* لون خلفية داكن للشريط */
            color: white;
            padding: 0.75rem 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000; /* يضمن ظهوره فوق المحتوى الآخر */
            display: flex;
            justify-content: center; /* توسيط الأزرار */
            gap: 1.5rem; /* مسافة بين الأزرار */
            flex-wrap: wrap; /* للسماح للأزرار بالانتقال لسطر جديد على الشاشات الصغيرة */
        }
        .navbar a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 0.4rem 0.6rem; /* تم تصغير المسافة الداخلية للزر */
            border-radius: 0.5rem;
            transition: background-color 0.2s ease;
            font-size: 0.9rem; /* تم تصغير حجم الخط هنا */
        }
        .navbar a:hover {
            background-color: #2d3748; /* لون أغمق عند المرور */
        }
        /* تنسيق الحاوية الرئيسية للصفحة */
        .container {
            max-width: 900px; /* أقصى عرض للحاوية */
            margin: 2rem auto; /* توسيط الحاوية عمودياً وأفقياً */
            padding: 1.5rem; /* مساحة داخلية */
            background-color: #ffffff; /* خلفية بيضاء */
            border-radius: 1rem; /* زوايا مستديرة */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); /* ظل خفيف */
        }
        /* تنسيق الأقسام الرئيسية */
        .section-card {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e2e8f0;
        }
        .section-card:first-of-type {
            margin-top: 0;
            padding-top: 0;
            border-top: none;
        }
        .section-card h2 {
            font-size: 2.25rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .info-box {
            background-color: #ffffff;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
        }
        .info-box h3 {
            font-size: 1.4rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 0.75rem;
        }
        .info-box p, .info-box li {
            color: #4a5568;
            line-height: 1.6;
        }
        .info-box ul {
            list-style-type: disc;
            padding-right: 1.5rem;
            margin-top: 0.5rem;
        }
        /* تنسيق مجموعات الإدخال (الميزانية والفئات) */
        .input-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
            display: block;
        }
        .input-group input[type="number"],
        .input-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            font-size: 1rem;
            color: #4a5568;
            background-color: #fdfdfd;
            transition: border-color 0.2s;
        }
        .input-group input[type="number"]:focus,
        .input-group select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
        }
        .checkbox-group label {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 0.5rem 0;
            color: #4a5568;
        }
        .checkbox-group input[type="checkbox"] {
            margin-left: 0.75rem;
            width: 1.25rem;
            height: 1.25rem;
            border-radius: 0.25rem;
            border: 1px solid #cbd5e0;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-color: #fdfdfd;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .checkbox-group input[type="checkbox"]:checked {
            background-color: #3b82f6;
            border-color: #3b82f6;
            position: relative;
        }
        .checkbox-group input[type="checkbox"]:checked::before {
            content: '✔';
            display: block;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.8rem;
            color: white;
        }
        .btn-primary {
            background-color: #22c55e;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .btn-primary:hover {
            background-color: #16a34a;
            transform: translateY(-1px);
        }
        .btn-primary:active {
            transform: translateY(0);
            box-shadow: none;
        }
        .results-section {
            margin-top: 2rem;
            border-top: 1px solid #e2e8f0;
            padding-top: 2rem;
        }
        .pv-progress-bar {
            width: 100%;
            background-color: #e2e8f0;
            border-radius: 0.5rem;
            overflow: hidden;
            height: 1.5rem;
            margin-bottom: 0.5rem;
        }
        .pv-progress {
            height: 100%;
            background-color: #3b82f6;
            width: 0%;
            border-radius: 0.5rem;
            transition: width 0.5s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 500;
            font-size: 0.9rem;
        }
        .option-card {
            background-color: #ffffff;
            border: 2px solid #e2e8f0;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
            transition: border-color 0.3s ease;
        }
        .option-card:hover {
            border-color: #3b82f6;
        }
        .option-card h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 1rem;
        }
        .option-card .summary-stats p {
            font-size: 1rem;
            color: #4a5568;
            margin-bottom: 0.5rem;
        }
        .option-card .summary-stats strong {
            color: #1a202c;
        }
        .option-card .product-list {
            margin-top: 1rem;
            border-top: 1px dashed #e2e8f0;
            padding-top: 1rem;
        }
        .option-card .product-item {
            display: flex;
            justify-content: space-between;
            padding: 0.4rem 0;
            border-bottom: 1px dotted #ebf4ff;
        }
        .option-card .product-item:last-child {
            border-bottom: none;
        }
        .option-card .product-item span {
            font-size: 0.95rem;
            color: #4a5568;
        }
        .option-card .product-item strong {
            color: #2d3748;
        }

        /* رسائل الخطأ */
        .error-message {
            background-color: #fee2e2;
            color: #ef4444;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            font-weight: 500;
        }
        /* رسائل المعلومات */
        .info-message {
            background-color: #e0f2fe;
            color: #0284c7;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            font-weight: 500;
        }
        /* رسائل النجاح */
        .success-message {
            background-color: #dcfce7;
            color: #16a34a;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            font-weight: 500;
        }
        /* تنسيق جدول المنتجات المضافة يدوياً */
        .manual-products-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        .manual-products-table th, .manual-products-table td {
            border: 1px solid #e2e8f0;
            padding: 0.75rem;
            text-align: right;
        }
        .manual-products-table th {
            background-color: #f0f2f5;
            font-weight: 600;
            color: #4a5568;
        }
        .manual-products-table td {
            background-color: #ffffff;
        }
        .manual-products-table button {
            background-color: #ef4444;
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 0.5rem;
            font-size: 0.8rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .manual-products-table button:hover {
            background-color: #dc2626;
        }
        /* تنسيق أزرار الطباعة والمشاركة */
        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            justify-content: center;
        }
        .action-buttons .btn {
            background-color: #3b82f6;
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 0.5rem;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            flex-grow: 1;
            max-width: 200px;
        }
        .action-buttons .btn:hover {
            background-color: #2563eb;
        }
        .action-buttons .btn-print {
            background-color: #6b7280;
        }
        .action-buttons .btn-print:hover {
            background-color: #4b5563;
        }
        /* إخفاء عناصر الصور تماماً */
        .product-image, .product-image-small {
            display: none !important; 
        }
        /* تعديل عرض الخلاصات لعدم وجود صور */
        .product-info-item summary {
            justify-content: flex-start;
            gap: 0.5rem;
        }
        /* تنسيق قسم معلومات عامة */
        .general-info-section .info-box {
            background-color: #ffffff;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
        }
        .general-info-section h3 {
            font-size: 1.4rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 0.75rem;
        }
        .general-info-section p, .general-info-section li {
            color: #4a5568;
            line-height: 1.6;
        }
        .general-info-section ul {
            list-style-type: disc;
            padding-right: 1.5rem;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- شريط التنقل الثابت -->
    <nav class="navbar">
        <a href="index.html">الرئيسية</a>
        <a href="idea.html">الفكرة الأساسية</a>
        <a href="mlm.html">فرصة العمل</a>
        <a href="products.html">المنتجات</a>
        <a href="commissions.html">العمولات</a>
        <a href="budget-planner.html">خطط ميزانيتك</a>
        <a href="manual-bundle.html" class="bg-blue-700">مجموعتك الخاصة</a>
        <a href="general-info.html">معلومات الريشي</a>
        <a href="resources.html">مصادر إضافية</a>
    </nav>

    <div class="container">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">هناده دكسن</h1>
        <p class="text-center text-gray-600 mb-8">مرحباً بكِ في دليلكِ الشامل لمنتجات DXN وفرصتها الفريدة! هنا نساعدكِ على اكتشاف عالم الصحة والجمال الطبيعي، وكيف يمكنكِ بناء مشروعكِ الخاص من المنزل.</p>

        <!-- قسم بناء المجموعة الخاصة -->
        <div id="manual-bundle-section" class="section-card">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">بناء مجموعتك الخاصة:</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div class="input-group md:col-span-2">
                    <label for="productSelect">اختر منتجاً:</label>
                    <select id="productSelect" class="w-full p-2 border border-gray-300 rounded-md">
                        <!-- خيارات المنتجات ستُضاف هنا بواسطة JavaScript -->
                    </select>
                </div>
                <div class="input-group">
                    <label for="productQuantity">الكمية:</label>
                    <input type="number" id="productQuantity" min="1" value="1" class="w-full p-2 border border-gray-300 rounded-md">
                </div>
            </div>
            <button id="addProductBtn" class="btn-primary w-full mb-4">إضافة المنتج للمجموعة</button>

            <div id="manualBundleDisplay" class="mb-6">
                <h3 class="text-xl font-semibold text-gray-700 mb-2">منتجات مجموعتك المخصصة:</h3>
                <table class="manual-products-table">
                    <thead>
                        <tr>
                            <th>المنتج</th>
                            <th>الكمية</th>
                            <th>PV</th>
                            <th>SV</th>
                            <th>السعر (د.أ)</th>
                            <th>إجراء</th>
                        </tr>
                    </thead>
                    <tbody id="manualProductsTableBody">
                        <!-- المنتجات المضافة يدوياً ستظهر هنا -->
                    </tbody>
                </table>
                <div class="summary-stats mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                    <p>إجمالي نقاط المجموعة المخصصة (PV): <strong id="manualTotalPv">0.00</strong></p>
                    <p>إجمالي قيمة المبيعات للمجموعة المخصصة (SV): <strong id="manualTotalSv">0.00</strong></p>
                    <p>إجمالي تكلفة المجموعة المخصصة (د.أ): <strong id="manualTotalCost">0.00</strong></p>
                    <p>العمولة التقديرية للمجموعة المخصصة: <strong id="manualEstimatedCommission">0.00</strong> دينار أردني</p>
                    <p class="text-sm text-gray-600 mt-2">ملاحظة: العمولة التقديرية تُحسب فقط إذا تجاوزت المجموعة 100 نقطة PV.</p>
                </div>
                <div class="action-buttons">
                    <button id="printManualBundleBtn" class="btn btn-print">طباعة المجموعة</button>
                    <button id="copyManualBundleBtn" class="btn">مشاركة / نسخ المجموعة</button>
                </div>
            </div>
        </div>
    </div>

    <!-- استيراد ملفات JavaScript المشتركة -->
    <script src="data.js" defer></script>
    <script src="utils.js" defer></script>
    <script>
        // استدعاء دالة إنشاء شريط التنقل بعد تحميل DOM
        window.onload = function() {
            // "manual-bundle-page" هو معرف الصفحة الحالية لتظليلها في شريط التنقل
            window.createNavbar("manual-bundle-page"); 

            // الوظائف الخاصة بهذه الصفحة
            const productSelect = document.getElementById('productSelect');
            const productQuantityInput = document.getElementById('productQuantity');
            const addProductBtn = document.getElementById('addProductBtn');
            const manualProductsTableBody = document.getElementById('manualProductsTableBody');
            const manualTotalPvSpan = document.getElementById('manualTotalPv');
            const manualTotalSvSpan = document.getElementById('manualTotalSv');
            const manualTotalCostSpan = document.getElementById('manualTotalCost');
            const manualEstimatedCommissionSpan = document.getElementById('manualEstimatedCommission');
            const printManualBundleBtn = document.getElementById('printManualBundleBtn');
            const copyManualBundleBtn = document.getElementById('copyManualBundleBtn');

            let manualBundleItems = []; // Array to hold manually added products

            // --- Event Listeners ---
            addProductBtn.addEventListener('click', addProductToManualBundle);
            // Assuming commissionRateInput is available globally or passed
            const commissionRateInput = document.getElementById('commissionRate'); // Get it here
            if (commissionRateInput) {
                commissionRateInput.addEventListener('input', updateManualBundleSummary);
            }
            printManualBundleBtn.addEventListener('click', printManualBundle);
            copyManualBundleBtn.addEventListener('click', copyManualBundle);

            // --- Initialization ---
            populateProductSelect(); // Populate the dropdown with all products
            updateManualBundleSummary(); // Initial update for manual bundle summary


            // --- Helper Functions ---

            // Populate the product dropdown in the manual bundle section
            function populateProductSelect() {
                productSelect.innerHTML = '<option value="">اختر منتج...</option>'; // Default option
                productsData.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.id; // Use product ID as value
                    option.textContent = `${product.name} (PV: ${product.PV}, السعر: ${product.DP.toFixed(2)} د.أ)`;
                    productSelect.appendChild(option);
                });
            }

            // Add product to manual bundle
            function addProductToManualBundle() {
                const selectedProductId = productSelect.value;
                const quantity = parseInt(productQuantityInput.value);

                if (!selectedProductId || isNaN(quantity) || quantity <= 0) {
                    window.showMessage('يرجى اختيار منتج وإدخال كمية صحيحة.', 'error');
                    return;
                }

                const productToAdd = productsData.find(p => p.id === selectedProductId);
                if (!productToAdd) {
                    window.showMessage('المنتج المختار غير موجود.', 'error');
                    return;
                }

                // Check if product already exists in manual bundle, then update quantity
                const existingItemIndex = manualBundleItems.findIndex(item => item.id === selectedProductId);
                if (existingItemIndex > -1) {
                    manualBundleItems[existingItemIndex].quantity += quantity;
                } else {
                    manualBundleItems.push({ ...productToAdd, quantity: quantity });
                }

                updateManualBundleDisplay();
                updateManualBundleSummary();
                window.showMessage('تمت إضافة المنتج بنجاح إلى مجموعتك المخصصة.', 'success');
            }

            // Remove product from manual bundle
            function removeProductFromManualBundle(productId) {
                manualBundleItems = manualBundleItems.filter(item => item.id !== productId);
                updateManualBundleDisplay();
                updateManualBundleSummary();
                window.showMessage('تمت إزالة المنتج من مجموعتك المخصصة.', 'info');
            }

            // Update the display table for manual bundle
            function updateManualBundleDisplay() {
                manualProductsTableBody.innerHTML = ''; // Clear table
                manualBundleItems.forEach(item => {
                    const row = manualProductsTableBody.insertRow();
                    row.innerHTML = `
                        <td>${item.name}</td>
                        <td>${item.quantity}</td>
                        <td>${(item.PV * item.quantity).toFixed(2)}</td>
                        <td>${(item.SV * item.quantity).toFixed(2)}</td>
                        <td>${(item.DP * item.quantity).toFixed(2)}</td>
                        <td><button onclick="removeProductFromManualBundle('${item.id}')">حذف</button></td>
                    `;
                });
            }

            // Update the summary for manual bundle
            function updateManualBundleSummary() {
                const commissionRate = parseFloat(commissionRateInput.value);
                const bundle = window.createBundle(manualBundleItems, commissionRate);

                manualTotalPvSpan.textContent = bundle.totalPV.toFixed(2);
                manualTotalSvSpan.textContent = bundle.totalSV.toFixed(2);
                manualTotalCostSpan.textContent = bundle.totalCost.toFixed(2);
                manualEstimatedCommissionSpan.textContent = bundle.estimatedCommission.toFixed(2);
            }

            // Function to print the manual bundle
            function printManualBundle() {
                const printContent = document.getElementById('manualBundleDisplay').innerHTML;
                const originalBody = document.body.innerHTML;

                // Create a new window for printing
                const printWindow = window.open('', '_blank');
                printWindow.document.open();
                printWindow.document.write(`
                    <html>
                    <head>
                        <title>مجموعتك المخصصة من DXN</title>
                        <style>
                            body { font-family: 'Inter', sans-serif; direction: rtl; text-align: right; margin: 20px; }
                            h3 { font-size: 24px; margin-bottom: 20px; text-align: center; }
                            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                            th, td { border: 1px solid #ddd; padding: 8px; text-align: right; }
                            th { background-color: #f2f2f2; }
                            .summary-stats { margin-top: 20px; padding: 15px; border: 1px solid #eee; background-color: #f9f9f9; border-radius: 8px; }
                            .summary-stats p { margin-bottom: 5px; }
                            .summary-stats strong { font-weight: bold; }
                            /* Hide buttons in print view */
                            .manual-products-table button, .action-buttons { display: none; }
                        </style>
                    </head>
                    <body>
                        ${printContent}
                    </body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.focus();
                printWindow.print();
                printWindow.close();
            }

            // Function to copy the manual bundle summary to clipboard
            function copyManualBundle() {
                const totalPv = manualTotalPvSpan.textContent;
                const totalSv = manualTotalSvSpan.textContent;
                const totalCost = manualTotalCostSpan.textContent;
                const estimatedCommission = manualEstimatedCommissionSpan.textContent;

                let textSummary = `ملخص مجموعتك المخصصة من DXN:\n\n`;
                textSummary += `المنتجات:\n`;
                manualBundleItems.forEach(item => {
                    textSummary += `- ${item.name} (الكمية: ${item.quantity}) - PV: ${(item.PV * item.quantity).toFixed(2)}, SV: ${(item.SV * item.quantity).toFixed(2)}, السعر: ${(item.DP * item.quantity).toFixed(2)} د.أ\n`;
                });
                textSummary += `\nإجمالي النقاط (PV): ${totalPv}\n`;
                textSummary += `إجمالي قيمة المبيعات (SV): ${totalSv}\n`;
                textSummary += `إجمالي التكلفة: ${totalCost} د.أ\n`;
                textSummary += `العمولة الشهرية التقديرية: ${estimatedCommission} د.أ\n`;
                textSummary += `\nملاحظة: العمولة التقديرية تُحسب فقط إذا تجاوزت المجموعة 100 نقطة PV.\n`;
                textSummary += `\nللمزيد من التفاصيل أو لطلب المنتجات، يرجى التواصل معي.`; // يمكنك إضافة رابط هنا

                // Use document.execCommand('copy') as it's more reliable in sandboxed environments
                const textarea = document.createElement('textarea');
                textarea.value = textSummary;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    window.showMessage('تم نسخ ملخص المجموعة إلى الحافظة بنجاح!', 'success');
                } catch (err) {
                    console.error('فشل نسخ الملخص باستخدام document.execCommand("copy"): ', err);
                    window.showMessage('فشل نسخ الملخص. يرجى المحاولة يدوياً.', 'error');
                }
                document.body.removeChild(textarea);
            }
        }; // End of window.onload
    </script>
</body>
</html>
